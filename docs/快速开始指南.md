# GD32é¡¹ç›®æ¡†æ¶å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸš€ å¿«é€Ÿä¸Šæ‰‹

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨30åˆ†é’Ÿå†…æ­å»ºå¹¶è¿è¡ŒGD32é¡¹ç›®æ¡†æ¶ã€‚

### ğŸ“‹ ç¯å¢ƒå‡†å¤‡

#### å¿…éœ€è½¯ä»¶
1. **Keil MDK-ARM** (v5.37æˆ–æ›´é«˜ç‰ˆæœ¬)
2. **STM32CubeMX** (å¯é€‰ï¿½ï¿½ç”¨äºé…ç½®å¤–è®¾)
3. **Node.js** (v16+ï¼Œç”¨äºWebæœåŠ¡å™¨)
4. **Git** (ç‰ˆæœ¬æ§åˆ¶)

#### ç¡¬ä»¶è¦æ±‚
- GD32F470/STM32F429å¼€å‘æ¿
- ST-Linkè°ƒè¯•å™¨
- USBæ•°æ®çº¿
- LEDã€æŒ‰é”®ç­‰åŸºç¡€å…ƒä»¶

### âš¡ 5åˆ†é’Ÿå¿«é€Ÿä½“éªŒ

#### 1. å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/your-repo/CIMC_xi.git
cd CIMC_xi
```

#### 2. æ‰“å¼€Keilé¡¹ç›®
```
æ‰“å¼€: example/MDK-ARM/test2.uvprojx
```

#### 3. ç¼–è¯‘å’Œä¸‹è½½
```
1. ç‚¹å‡» Build (F7) ç¼–è¯‘é¡¹ç›®
2. ç‚¹å‡» Download (F8) ä¸‹è½½åˆ°å¼€å‘æ¿
```

#### 4. è¿è¡ŒWebæœåŠ¡å™¨
```bash
cd web/backend
npm install
npm start
```

#### 5. è®¿é—®è°ƒè¯•ç•Œé¢
```
æ‰“å¼€æµè§ˆå™¨: http://localhost:8080
ç‚¹å‡» "è°ƒè¯•æ¨¡å¼" è¿›å…¥LEDæ§åˆ¶ç•Œé¢
```

## ğŸ”§ è¯¦ç»†é…ç½®æ­¥éª¤

### ç¬¬ä¸€æ­¥: ç¡¬ä»¶é…ç½®

#### 1.1 æ£€æŸ¥ç¡¬ä»¶è¿æ¥
```
LED1-LED6 -> PC0-PC5
KEY1-KEY2  -> PA0-PA1
USART1     -> PA9(TX), PA10(RX)
USART2     -> PA2(TX), PA3(RX)  // 4Gæ¨¡å—
```

#### 1.2 ä¾›ç”µè®¾ç½®
- ç¡®ä¿å¼€å‘æ¿ä¾›ç”µæ­£å¸¸ (3.3V/5V)
- æ£€æŸ¥ST-Linkè¿æ¥
- éªŒè¯LEDå’ŒæŒ‰é”®è¿æ¥

### ç¬¬äºŒæ­¥: è½¯ä»¶é…ç½®

#### 2.1 Keilé¡¹ç›®é…ç½®

**ç›®æ ‡è®¾ç½®**:
```
Project -> Options for Target:
  Target -> Device: STM32F429IGT6
  Target -> XTAL: 8MHz
  Target -> CPU Clock: 180MHz
```

**ç¼–è¯‘è®¾ç½®**:
```
C/C++ -> Define: USE_HAL_DRIVER, STM32F429xx
C/C++ -> Optimization: -O2
  Debug -> Use: ST-Link Debugger
```

#### 2.2 å¤–è®¾é…ç½® (å¦‚æœé‡æ–°ç”Ÿæˆ)

**æ—¶é’Ÿé…ç½®**:
```
HSE: 8MHz
PLL: M=8, N=360, P=2  -> 180MHz
APB1: 90MHz
APB2: 180MHz
```

**GPIOé…ç½®**:
```
PC0-PC5: Output (LED)
PA0-PA1: Input (KEY)
PA9-PA10: USART1
PA2-PA3: USART2
```

### ç¬¬ä¸‰æ­¥: WebæœåŠ¡é…ç½®

#### 3.1 å®‰è£…ä¾èµ–
```bash
cd web/backend
npm install ws express
```

#### 3.2 é…ç½®ç«¯å£
```javascript
// websocket-server.js
const WS_PORT = 47315;  // WebSocketç«¯å£

// http-server.js
const HTTP_PORT = 8080; // HTTPç«¯å£
```

#### 3.3 å¯åŠ¨æœåŠ¡
```bash
npm start  # åŒæ—¶å¯åŠ¨WebSocketå’ŒHTTPæœåŠ¡å™¨
```

### ç¬¬å››æ­¥: åŠŸèƒ½æµ‹è¯•

#### 4.1 åŸºç¡€LEDæµ‹è¯•
```c
// åœ¨main.cä¸­æ·»åŠ æµ‹è¯•ä»£ç 
int main(void) {
    HAL_Init();
    SystemClock_Config();
    MX_GPIO_Init();

    while (1) {
        // LEDé—ªçƒæµ‹è¯•
        HAL_GPIO_WritePin(GPIOC, GPIO_PIN_0, GPIO_PIN_SET);
        HAL_Delay(500);
        HAL_GPIO_WritePin(GPIOC, GPIO_PIN_0, GPIO_PIN_RESET);
        HAL_Delay(500);
    }
}
```

#### 4.2 ä¸²å£é€šä¿¡æµ‹è¯•
```c
// æµ‹è¯•ä¸²å£è¾“å‡º
printf("Hello GD32 Framework!\r\n");
```

#### 4.3 Webæ§åˆ¶æµ‹è¯•
1. æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:8080
2. ç‚¹å‡»"è°ƒè¯•æ¨¡å¼"
3. ç‚¹å‡»LEDæ§åˆ¶æŒ‰é’®
4. è§‚å¯Ÿå¼€å‘æ¿LEDçŠ¶æ€

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½ä½¿ç”¨

### ä»»åŠ¡è°ƒåº¦å™¨ä½¿ç”¨
```c
// åœ¨scheduler.cä¸­æ·»åŠ æ–°ä»»åŠ¡
{your_task, 100, 0}  // 100msæ‰§è¡Œä¸€æ¬¡

// å®ç°ä»»åŠ¡å‡½æ•°
void your_task(void) {
    // ä½ çš„ä»»åŠ¡ä»£ç 
    static uint32_t counter = 0;
    counter++;
    if (counter % 10 == 0) {
        printf("Task running: %lu\r\n", counter);
    }
}
```

### WebSocket LEDæ§åˆ¶
```javascript
// å‰ç«¯JavaScriptä»£ç 
function controlLED(ledNum, state) {
    const command = state === 1 ? `LED${ledNum}_ON` : `LED${ledNum}_OFF`;
    if (websocket && websocket.readyState === WebSocket.OPEN) {
        websocket.send(command);
    }
}
```

```c
// åç«¯å¤„ç†ä»£ç  (4g_web.c)
void websocket_parse_led_command(uint8_t *buffer, uint16_t length) {
    if (strncmp((char*)buffer, "LED1_ON", 7) == 0) {
        ucLed[0] = 1;
        led_disp(ucLed);
        websocket_send_led_response(1, 1);
    }
}
```

### Shellå‘½ä»¤ä½¿ç”¨
```c
// æ³¨å†Œæ–°å‘½ä»¤
void cmd_test(char *args) {
    printf("Test command executed\r\n");
}

shell_cmd_t test_cmd = {
    .name = "test",
    .func = cmd_test,
    .help = "test - Test command"
};

// åœ¨shell_init()ä¸­æ³¨å†Œ
shell_register_command(&test_cmd);
```

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. ä¸²å£è°ƒè¯•
```c
// ä½¿ç”¨printfè¿›è¡Œè°ƒè¯•è¾“å‡º
printf("Debug: Variable value = %d\r\n, variable");
```

### 2. LEDæŒ‡ç¤ºè°ƒè¯•
```c
// ä½¿ç”¨LEDçŠ¶æ€æŒ‡ç¤ºç¨‹åºè¿è¡ŒçŠ¶æ€
led_set(1, 1);  // ç‚¹äº®LED1è¡¨ç¤ºæ­£å¸¸
led_set(2, 1);  // ç‚¹äº®LED2è¡¨ç¤ºé”™è¯¯
```

### 3. Webè°ƒè¯•
```javascript
// æµè§ˆå™¨æ§åˆ¶å°è°ƒè¯•
console.log("WebSocketè¿æ¥çŠ¶æ€:", websocket.readyState);

// æŸ¥çœ‹ç½‘ç»œè¯·æ±‚
// æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…· -> Networkæ ‡ç­¾
```

## âŒ å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜1: ç¼–è¯‘é”™è¯¯
**ç°è±¡**: ç¼–è¯‘æ—¶å‡ºç°å¤§é‡é”™è¯¯
**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥å¤´æ–‡ä»¶è·¯å¾„è®¾ç½®
2. ç¡®è®¤å®å®šä¹‰æ­£ç¡® (USE_HAL_DRIVER, STM32F429xx)
3. æ£€æŸ¥æ‰€æœ‰æºæ–‡ä»¶æ˜¯å¦å·²æ·»åŠ åˆ°é¡¹ç›®

### é—®é¢˜2: ä¸‹è½½å¤±è´¥
**ç°è±¡**: ç¨‹åºæ— æ³•ä¸‹è½½åˆ°å¼€å‘æ¿
**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ST-Linkè¿æ¥
2. ç¡®è®¤å¼€å‘æ¿ä¾›ç”µ
3. åœ¨Keilä¸­é‡æ–°é…ç½®è°ƒè¯•å™¨è®¾ç½®

### é—®é¢˜3: ç¨‹åºä¸è¿è¡Œ
**ç°è±¡**: ä¸‹è½½åLEDä¸é—ªçƒï¼Œä¸²å£æ— è¾“å‡º
**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥æ—¶é’Ÿé…ç½®
2. ç¡®è®¤å¼•è„šé…ç½®æ­£ç¡®
3. ä½¿ç”¨è°ƒè¯•å™¨å•æ­¥æ‰§è¡Œ

### é—®é¢˜4: WebSocketè¿æ¥å¤±è´¥
**ç°è±¡**: Webç•Œé¢æ— æ³•è¿æ¥å¼€å‘æ¿
**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤4Gæ¨¡å—æ­£å¸¸å·¥ä½œ
2. æ£€æŸ¥ä¸²å£è¿æ¥
3. éªŒè¯WebSocketæœåŠ¡å™¨è¿è¡Œ

### é—®é¢˜5: LEDæ§åˆ¶æ— æ•ˆ
**ç°è±¡**: ç‚¹å‡»WebæŒ‰é’®LEDæ— ååº”
**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥LEDç¡¬ä»¶è¿æ¥
2. éªŒè¯WebSocketå‘½ä»¤ä¼ è¾“
3. æ£€æŸ¥å‘½ä»¤è§£æé€»è¾‘

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. ä»»åŠ¡è°ƒåº¦ä¼˜åŒ–
```c
// åˆç†è®¾ç½®ä»»åŠ¡æ‰§è¡Œå‘¨æœŸ
{led_task, 10, 0}    // 10msï¼ŒLEDéœ€è¦å¿«é€Ÿå“åº”
{adc_task, 100, 0}   // 100msï¼ŒADCé‡‡æ ·é€‚ä¸­é¢‘ç‡
{uart_task, 5, 0}    // 5msï¼Œä¸²å£éœ€è¦åŠæ—¶å¤„ç†
```

### 2. å†…å­˜ä¼˜åŒ–
```c
// ä½¿ç”¨åˆé€‚çš„æ•°æ®ç±»å‹
uint8_t  small_number;    // 0-255
uint16_t medium_number;   // 0-65535
uint32_t large_number;    // æ›´å¤§æ•°å€¼
```

### 3. ä¸­æ–­ä¼˜åŒ–
```c
// ä¸­æ–­æœåŠ¡ç¨‹åºä¿æŒç®€çŸ­
void USART1_IRQHandler(void) {
    // åªè®¾ç½®æ ‡å¿—ä½
    uart1_received_flag = 1;
}

// åœ¨ä¸»å¾ªç¯ä¸­å¤„ç†
void uart_task(void) {
    if (uart1_received_flag) {
        // å¤„ç†æ¥æ”¶æ•°æ®
        uart1_received_flag = 0;
    }
}
```

## ğŸ¨ ä¸‹ä¸€æ­¥å¼€å‘

### 1. æ·»åŠ æ–°å¤–è®¾
```c
// 1. åˆ›å»ºæ–°çš„æ¨¡å—æ–‡ä»¶
new_peripheral.c
new_peripheral.h

// 2. å®ç°åŸºç¡€æ¥å£
void new_peripheral_init(void);
void new_peripheral_task(void);

// 3. æ·»åŠ åˆ°è°ƒåº¦å™¨
{new_peripheral_task, 50, 0}

// 4. åœ¨mydefine.hä¸­åŒ…å«å¤´æ–‡ä»¶
#include "new_peripheral.h"
```

### 2. é›†æˆæ–°ä¼ æ„Ÿå™¨
```c
// ç¤ºä¾‹: æ·»åŠ æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨
void sensor_task(void) {
    static uint32_t last_read = 0;
    if (HAL_GetTick() - last_read > 1000) {
        float temp = read_temperature();
        float humi = read_humidity();
        printf("Temp: %.1fÂ°C, Humi: %.1f%%\r\n", temp, humi);
        last_read = HAL_GetTick();
    }
}
```

### 3. Webç•Œé¢æ‰©å±•
```javascript
// æ·»åŠ æ–°çš„æ§åˆ¶é¢æ¿
function addControlPanel(elementId) {
    const panel = document.createElement('div');
    panel.innerHTML = `
        <h3>ä¼ æ„Ÿå™¨æ•°æ®</h3>
        <div>æ¸©åº¦: <span id="temp">--</span>Â°C</div>
        <div>æ¹¿åº¦: <span id="humi">--</span>%</div>
    `;
    document.getElementById(elementId).appendChild(panel);
}
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### å¸¸ç”¨èµ„æº
- **STM32 HALåº“æ–‡æ¡£**: [å®˜æ–¹æ–‡æ¡£é“¾æ¥]
- **STM32F429æ•°æ®æ‰‹å†Œ**: [æ•°æ®æ‰‹å†Œé“¾æ¥]
- **é¡¹ç›®æºç **: [GitHubä»“åº“é“¾æ¥]
- **é—®é¢˜åé¦ˆ**: [Issuesé“¾æ¥]

### ç¤¾åŒºæ”¯æŒ
- æŠ€æœ¯äº¤æµç¾¤: [ç¾¤å·]
- å¼€å‘è€…è®ºå›: [è®ºå›é“¾æ¥]
- è§†é¢‘æ•™ç¨‹: [è§†é¢‘é“¾æ¥]

---

**æ­å–œï¼** ğŸ‰ æ‚¨å·²ç»å®Œæˆäº†GD32é¡¹ç›®æ¡†æ¶çš„å¿«é€Ÿå¼€å§‹ã€‚ç°åœ¨å¯ä»¥å¼€å§‹æ‚¨çš„é¡¹ç›®å¼€å‘äº†ï¼

**ä¸‹ä¸€æ­¥å»ºè®®**:
1. é˜…è¯»å®Œæ•´çš„APIå‚è€ƒæ‰‹å†Œ
2. æŸ¥çœ‹æ›´å¤šç¤ºä¾‹ä»£ç 
3. å¼€å§‹æ‚¨çš„ç¬¬ä¸€ä¸ªé¡¹ç›®
4. åˆ†äº«æ‚¨çš„ä½¿ç”¨ç»éªŒ

**è®°ä½**: é‡åˆ°é—®é¢˜æ—¶ï¼Œè¯·å‚è€ƒå¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆæˆ–æŸ¥é˜…APIæ–‡æ¡£ã€‚