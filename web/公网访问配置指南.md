# 公网访问配置指南

## 🎯 目标
让别人能通过 `http://www.yanjin.xyz` 访问你的WebSocket终端管理系统

## ✅ 当前状态分析

### 已配置完成 ✅
- [x] **WebSocket服务器**: 运行在端口8080，支持数据转发
- [x] **HTTP静态文件服务**: 已合并到同一端口(8080)
- [x] **前端自动配置**: 检测访问域名并自动填充连接配置
- [x] **FRP WebSocket穿透**: 4G模块已能连接 `ws://www.yanjin.xyz`

### 需要配置 🔄
- [ ] **FRP HTTP穿透**: 确保HTTP请求能通过公网域名访问

## 🔧 FRP配置方案

### 方案1: 单端口HTTP映射（推荐）

如果你当前的FRP配置只有WebSocket映射，需要添加HTTP映射：

#### FRP客户端配置 (frpc.ini 或 frpc.toml)

**INI格式**:
```ini
[common]
server_addr = 你的FRP服务器地址
server_port = 7000

[web_terminal]
type = http
local_ip = 127.0.0.1
local_port = 8080
custom_domains = www.yanjin.xyz
```

**TOML格式**:
```toml
[[proxies]]
name = "web_terminal"
type = "http"
localIP = "127.0.0.1"
localPort = 8080
customDomains = ["www.yanjin.xyz"]
```

### 方案2: 如果已有TCP映射

如果你已经有TCP映射到8080端口，需要改为HTTP类型：

**修改前（仅支持WebSocket）**:
```ini
[websocket]
type = tcp
local_port = 8080
remote_port = 8080
```

**修改后（支持HTTP+WebSocket）**:
```ini
[web_terminal]
type = http
local_port = 8080
custom_domains = www.yanjin.xyz
```

## 🌐 HTTP协议特性

HTTP协议本身支持WebSocket升级，所以单个HTTP映射可以同时处理：
- ✅ 网页访问（HTTP GET请求）
- ✅ WebSocket连接（HTTP升级请求）

## 🚀 验证步骤

### 1. 本地测试
```bash
# 测试HTTP服务
curl -I http://localhost:8080

# 预期返回:
# HTTP/1.1 200 OK
# Content-Type: text/html; charset=utf-8
```

### 2. FRP配置验证
启动/重启FRP客户端后，检查日志：
```bash
# 应该看到类似输出:
# [web_terminal] start proxy success
```

### 3. 公网测试
使用手机4G网络或其他外部网络：
```bash
# 测试公网访问
curl -I http://www.yanjin.xyz

# 测试域名解析
nslookup www.yanjin.xyz
```

## 🔍 故障排除

### 问题1: 域名能ping通，但���页打不开
**原因**: FRP配置类型错误（TCP而非HTTP）
**解决**: 确保FRP配置中 `type = http`

### 问题2: 网页打开但WebSocket连接失败
**原因**: 前端自动配置的端口不正确
**解决**: 检查前端自动检测的端口号，必要时手动设置

### 问题3: 完全无法访问
**原因**: FRP服务未运行或配置错误
**解决**:
1. 检查FRP客户端是否正在运行
2. 验证FRP服务器地址和端口
3. 查看FRP日志文件

## 📱 使用流程

### 对你（服务器端）:
1. 确保Node.js服务器运行: `node server.js`
2. 确保FRP客户端运行并正确配置
3. 本地测试: `http://localhost:8080`

### 对访问者（客户端）:
1. 浏览器打开: `http://www.yanjin.xyz`
2. 页面自动配置连接参数（域名和端口）
3. 点击"连接服务器"
4. 开始发送和接收消息

## 🎯 预期效果

配置完成后，任何人都可以：
- 通过浏览器访问 `http://www.yanjin.xyz`
- 看到完整的WebSocket终端管理界面
- 连接到服务器并实时通信
- 与你的4G模块或其他客户端双向通信

## 📞 技术支持

如果遇到问题：
1. 检查FRP配置文件格式
2. 查看FRP客户端日志
3. 验证本地服务器是否正常运行
4. 确认域名解析是否正确

---

**注意**: HTTP类型的FRP映射会自动处理WebSocket升级请求，无需单独配置WebSocket映射。